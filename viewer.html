<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Viewer Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Firebase and Firestore SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f9f9f9;
      text-align: center;
    }
    #main {
      padding: 20px;
    }
    .ads-block {
      margin-bottom: 20px;
    }
    .square-banner {
      margin-bottom: 10px;
    }
    .square-banner img {
      cursor: pointer;
    }
    .ad-banner, .ad-text {
      margin: 10px auto;
      width: fit-content;
    }
    .iframe-container {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    iframe {
      width: 1200px;
      height: 1000px;
      border: none;
    }
    .notice {
      font-weight: bold;
      font-size: 18px;
      color: #a00;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

  <div id="header"></div>
  <div id="nav"></div>

  <div id="main">
    <div class="notice">▼▼▼ SCROLL DOWN TO VIEW SITE ▼▼▼</div>

    <div class="ads-block">
      <div class="square-banner">
        <a href="index.html">
          <img src="https://cdn-images.imagevenue.com/64/1b/fc/ME1AW7GR_o.png" width="125" height="125" alt="Limited Offer" />
        </a>
      </div>
      <div id="bannerAd" class="ad-banner"></div>
      <div id="textAd" class="ad-text"></div>
    </div>

    <div class="iframe-container">
      <iframe id="iframeAd" src=""></iframe>
    </div>
  </div>

  <div id="footer"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBz0VX...REDACTED",
      authDomain: "saphahcentral.firebaseapp.com",
      projectId: "saphahcentral",
      storageBucket: "saphahcentral.appspot.com",
      messagingSenderId: "1030896509782",
      appId: "1:1030896509782:web:6e97a49db0f7cf673aa16e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <script>
    async function loadHTML(id, file) {
      const res = await fetch(file);
      const html = await res.text();
      document.getElementById(id).innerHTML = html;
    }

    loadHTML("header", "header.html");
    loadHTML("nav", "nav.html");
    loadHTML("footer", "footer.html");
  </script>

  <script>
    // Robust random pick that returns null if array empty
    function pickRandom(arr) {
      if (!arr || arr.length === 0) return null;
      const index = Math.floor(Math.random() * arr.length);
      return arr[index];
    }

    async function loadAds() {
      try {
        const adSnapshot = await db.collection("ad_list").get();
        const ads = adSnapshot.docs.map(doc => doc.data());
        console.log("Ads fetched:", ads);

        const bannerAds = ads.filter(ad => ad.type === "banner");
        const textAds = ads.filter(ad => ad.type === "text");
        const iframeAds = ads.filter(ad => ad.type === "iframe");

        console.log("Banner Ads:", bannerAds);
        console.log("Text Ads:", textAds);
        console.log("Iframe Ads:", iframeAds);

        const bannerAd = pickRandom(bannerAds);
        if (bannerAd) {
          document.getElementById("bannerAd").innerHTML = `
            <a href="${bannerAd.link}" target="_blank" rel="noopener noreferrer">
              <img src="${bannerAd.image}" width="468" height="60" alt="Banner Ad" />
            </a>`;
        } else {
          console.log("No banner ad found; displaying fallback.");
          document.getElementById("bannerAd").innerHTML = `<div>No banner ads available.</div>`;
        }

        const textAd = pickRandom(textAds);
        if (textAd) {
          document.getElementById("textAd").innerHTML = `
            <a href="${textAd.link}" target="_blank" rel="noopener noreferrer" style="text-decoration:none;color:#000;">
              <strong>${textAd.title}</strong><br />
              ${textAd.body}
            </a>`;
        } else {
          console.log("No text ad found; displaying fallback.");
          document.getElementById("textAd").innerHTML = `<div>No text ads available.</div>`;
        }

        const iframeAd = pickRandom(iframeAds);
        if (iframeAd) {
          document.getElementById("iframeAd").src = iframeAd.link;
        } else {
          console.log("No iframe ad found; clearing iframe src.");
          document.getElementById("iframeAd").src = "";
        }

      } catch (error) {
        console.error("Error loading ads:", error);
      }
    }

    loadAds();
  </script>

</body>
</html>
