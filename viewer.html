<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ad Viewer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 10px;
    }
    #square-banner {
      margin-bottom: 15px;
    }
    #square-banner img {
      width: 125px;
      height: 125px;
      cursor: pointer;
    }
    #banner-ad, #text-ad {
      margin: 15px auto;
      max-width: 728px;
      min-height: 60px;
      border: 1px solid #ccc;
      padding: 5px;
      color: #555;
    }
    #ad-iframe {
      width: 728px;
      height: 90px;
      border: 1px solid #ccc;
      margin: 15px auto;
      display: block;
    }
  </style>
</head>
<body>

  <!-- Square Banner linking to index.html -->
  <div id="square-banner" title="Go to Home">
    <a href="index.html" target="_self">
      <img src="https://cdn-images.imagevenue.com/64/1b/fc/ME1AW7GR_o.png" alt="Square Banner" />
    </a>
  </div>

  <!-- Banner Ad -->
  <div id="banner-ad">Loading banner ad...</div>

  <!-- Text Ad -->
  <div id="text-ad">Loading text ad...</div>

  <!-- Iframe Ad -->
  <iframe id="ad-iframe" src="" title="Iframe Ad"></iframe>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script>
    // Your Firebase configuration here â€” replace with your actual config!
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();

    function getRandomElement(arr) {
      if (!arr.length) return null;
      return arr[Math.floor(Math.random() * arr.length)];
    }

    async function loadAds() {
      try {
        const snapshot = await db.collection('ad_list').get();
        const ads = [];
        snapshot.forEach(doc => ads.push(doc.data()));

        console.log('All ads fetched:', ads);

        // Filter active ads by type
        const bannerAds = ads.filter(ad => ad.type === 'banner' && ad.status === 'active' && ad.html);
        const textAds = ads.filter(ad => ad.type === 'text' && ad.status === 'active' && ad.html);
        const iframeAds = ads.filter(ad => ad.type === 'iframe' && ad.status === 'active' && ad.url);

        console.log('Banner ads:', bannerAds);
        console.log('Text ads:', textAds);
        console.log('Iframe ads:', iframeAds);

        // Pick random ad of each type
        const bannerAd = getRandomElement(bannerAds);
        const textAd = getRandomElement(textAds);
        const iframeAd = getRandomElement(iframeAds);

        console.log('Selected banner ad:', bannerAd);
        console.log('Selected text ad:', textAd);
        console.log('Selected iframe ad:', iframeAd);

        // Display banner ad
        const bannerDiv = document.getElementById('banner-ad');
        if (bannerAd) {
          bannerDiv.innerHTML = bannerAd.html;
        } else {
          bannerDiv.textContent = 'No banner ad available.';
        }

        // Display text ad
        const textDiv = document.getElementById('text-ad');
        if (textAd) {
          textDiv.innerHTML = textAd.html;
        } else {
          textDiv.textContent = 'No text ad available.';
        }

        // Set iframe ad src
        const iframe = document.getElementById('ad-iframe');
        if (iframeAd) {
          iframe.src = iframeAd.url;
        } else {
          iframe.src = '';
          iframe.style.display = 'none';
        }

      } catch (error) {
        console.error('Error loading ads:', error);
        document.getElementById('banner-ad').textContent = 'Error loading banner ad.';
        document.getElementById('text-ad').textContent = 'Error loading text ad.';
        const iframe = document.getElementById('ad-iframe');
        iframe.src = '';
        iframe.style.display = 'none';
      }
    }

    loadAds();
  </script>

</body>
</html>
