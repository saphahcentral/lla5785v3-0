<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ad Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Content Security Policy to allow required content -->
  <meta http-equiv="Content-Security-Policy"
    content="default-src * data: blob: filesystem: about: 'unsafe-inline' 'unsafe-eval'; script-src * 'unsafe-inline' 'unsafe-eval'; style-src * 'unsafe-inline'; img-src * data: blob: filesystem: https: http:; child-src * blob: filesystem: data:; frame-src *;">

  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }
    .scroll-banner {
      background: red;
      color: yellow;
      font-weight: bold;
      white-space: nowrap;
      overflow: hidden;
      box-sizing: border-box;
      padding: 5px;
      font-size: 14px;
    }
    .scroll-banner span {
      display: inline-block;
      padding-left: 100%;
      animation: scroll 15s linear infinite;
    }
    @keyframes scroll {
      0% { transform: translateX(0%); }
      100% { transform: translateX(-100%); }
    }
    .invite-bar {
      background-color: yellow;
      text-align: center;
      font-weight: bold;
      padding: 5px;
    }
    .ad-table {
      display: flex;
      justify-content: space-between;
      background-color: wheat;
      padding: 5px;
      max-height: 70px;
    }
    .ad-cell {
      flex: 1;
      text-align: center;
      padding: 5px;
    }
    iframe {
      width: 100%;
      height: 1000px;
      border: none;
    }
  </style>
</head>
<body>

  <!-- Compact header -->
  <div id="header-container">Loading header...</div>

  <!-- Scrolling info bar -->
  <div class="scroll-banner">
    <span>â¬… SCROLL TO VIEW ALL ADS âž¡ SCROLL TO VIEW ALL ADS âž¡</span>
  </div>

  <!-- Invite link bar -->
  <div class="invite-bar">
    <a href="https://saphahcentral.github.io/lla5785v3-0/account1.html" target="_blank">
      ðŸ‘‰ ADD YOUR WEBSITE HERE FOR MAXIMUM LIFETIME EXPOSURE!
    </a>
  </div>

  <!-- Banner & Text Ad -->
  <div class="ad-table">
    <div id="bannerAd" class="ad-cell">Loading banner ad...</div>
    <div id="textAd" class="ad-cell">Loading text ad...</div>
  </div>

  <!-- Iframe Ad -->
  <iframe id="adIframe" src="about:blank"></iframe>

  <!-- Bottom Nav -->
  <div id="nav-container">Loading navigation...</div>

  <!-- Footer -->
  <div id="footer-container">Loading footer...</div>

  <!-- Firebase & Ad Fetch Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBBn8RmuXVvkbbBB0IquYr9S6hXhIgrQCQ",
      authDomain: "lla5785.firebaseapp.com",
      projectId: "lla5785",
      storageBucket: "lla5785.appspot.com",
      messagingSenderId: "730972554331",
      appId: "1:730972554331:web:d97a5fbacebd6aa6e32b7e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    async function fetchAdsAndDisplay() {
      try {
        const adsSnapshot = await db.collection("ad_list").get();
        const ads = adsSnapshot.docs.map(doc => doc.data());

        if (ads.length < 3) {
          console.warn("Not enough ads in Firestore. Using fallback.");
          useFallbackAds();
          return;
        }

        const [bannerAd, textAd, iframeAd] = shuffle(ads).slice(0, 3);

        document.getElementById("bannerAd").innerHTML = `
          <a href="${bannerAd.url}" target="_blank">
            <img src="${bannerAd.banner}" alt="Banner Ad" style="max-height:60px;">
          </a>
        `;

        document.getElementById("textAd").innerHTML = `
          <a href="${textAd.url}" target="_blank" style="color: blue; text-decoration: underline;">
            ${textAd.text}
          </a>
        `;

        document.getElementById("adIframe").src = iframeAd.url;
      } catch (error) {
        console.error("Error fetching ads:", error);
        useFallbackAds();
      }
    }

    function useFallbackAds() {
      document.getElementById("bannerAd").innerHTML = `
        <a href="https://example.com/fallback1" target="_blank">
          <img src="https://via.placeholder.com/468x60?text=Fallback+Banner" alt="Fallback Banner">
        </a>
      `;
      document.getElementById("textAd").innerHTML = `
        <a href="https://example.com/fallback2" target="_blank" style="color: blue; text-decoration: underline;">
          Fallback Text Ad - Click Here!
        </a>
      `;
      document.getElementById("adIframe").src = "https://example.com/fallback-ad";
    }

    window.addEventListener("load", () => {
      fetchAdsAndDisplay();
      loadPartials();
    });

    function loadPartials() {
      fetch("header.html")
        .then(res => res.text())
        .then(html => document.getElementById("header-container").innerHTML = html);
      fetch("nav_external.html")
        .then(res => res.text())
        .then(html => document.getElementById("nav-container").innerHTML = html);
      fetch("footer.html")
        .then(res => res.text())
        .then(html => document.getElementById("footer-container").innerHTML = html);
    }
  </script>
</body>
</html>
