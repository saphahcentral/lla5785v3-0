<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ad Viewer - LLA5785</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    .nav-placeholder {
      width: 100%;
    }
    .square-banner {
      margin: 10px auto;
      display: block;
      width: 125px;
      height: 125px;
    }
    .ad-block {
      background: #fff;
      margin: 20px auto;
      padding: 10px;
      width: 90%;
      max-width: 600px;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    iframe {
      width: 100%;
      height: 150px;
      border: none;
    }
    .note {
      margin-top: 15px;
      color: #555;
      font-style: italic;
    }
  </style>
</head>
<body>

  <!-- Navigation -->
  <div class="nav-placeholder" id="nav-placeholder"></div>

  <!-- Square Banner (links to homepage) -->
  <a href="index.html">
    <img src="https://cdn-images.imagevenue.com/64/1b/fc/ME1AW7GR_o.png" alt="LLA5785 Banner" class="square-banner">
  </a>

  <!-- Ad Blocks -->
  <div class="ad-block" id="banner-ad"></div>
  <div class="ad-block" id="text-ad"></div>
  <div class="ad-block" id="iframe-ad"></div>

  <p class="note">SCROLL DOWN TO VIEW MORE ADS</p>

  <!-- Firebase & Ad Fetch Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBBn8RmuXVvkbbBB0IquYr9S6hXhIgrQCQ",
      authDomain: "lla5785v3-0.firebaseapp.com",
      projectId: "lla5785v3-0",
      storageBucket: "lla5785v3-0.appspot.com",
      messagingSenderId: "730972554331",
      appId: "1:730972554331:web:d97a5fbacebd6aa6e32b7e",
      measurementId: "G-WZNQ24S4DM"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Helper: Random item
    function getRandomItem(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    async function loadAds() {
      const snapshot = await getDocs(collection(db, "ad_list"));
      const ads = snapshot.docs.map(doc => doc.data());

      const bannerAds = ads.filter(ad => ad.type === "banner");
      const textAds = ads.filter(ad => ad.type === "text");
      const iframeAds = ads.filter(ad => ad.type === "iframe");

      const bannerAd = getRandomItem(bannerAds);
      const textAd = getRandomItem(textAds);
      const iframeAd = getRandomItem(iframeAds);

      // Display banner ad (468x60)
      document.getElementById("banner-ad").innerHTML = bannerAd
        ? `<a href="${bannerAd.link}" target="_blank"><img src="${bannerAd.image}" width="468" height="60" alt="Banner Ad"></a>`
        : "<p>No banner ad available</p>";

      // Display text ad
      document.getElementById("text-ad").innerHTML = textAd
        ? `<a href="${textAd.link}" target="_blank">${textAd.text}</a>`
        : "<p>No text ad available</p>";

      // Display iframe ad
      document.getElementById("iframe-ad").innerHTML = iframeAd
        ? `<iframe src="${iframeAd.link}"></iframe>`
        : "<p>No iframe ad available</p>";
    }

    loadAds();
  </script>

  <!-- Load shared nav bar -->
  <script>
    fetch("nav_external.html")
      .then(res => res.text())
      .then(data => {
        document.getElementById("nav-placeholder").innerHTML = data;
      })
      .catch(err => console.error("Nav load failed", err));
  </script>

</body>
</html>
