<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ad Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    #top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #f2f2f2;
      padding: 10px;
    }
    #square-banner {
      width: 125px;
      height: 125px;
    }
    #ads-container {
      padding: 20px;
      text-align: center;
    }
    .ad-block {
      margin: 20px auto;
      max-width: 600px;
    }
    .text-ad {
      border: 1px solid #ccc;
      padding: 10px;
      font-size: 16px;
      background: #fafafa;
    }
  </style>
</head>
<body>

  <!-- Top Navigation Bar -->
  <div id="top-bar">
    <div id="nav-placeholder"></div>
    <a href="index.html" target="_blank">
      <img id="square-banner" src="https://cdn-images.imagevenue.com/64/1b/fc/ME1AW7GR_o.png" alt="Home Banner">
    </a>
  </div>

  <!-- Ad Content -->
  <div id="ads-container">
    <p><strong>SCROLL DOWN TO VIEW</strong></p>

    <div id="banner-ad" class="ad-block"></div>
    <div id="text-ad" class="ad-block"></div>
    <div id="iframe-ad" class="ad-block"></div>
  </div>

  <!-- Firebase + Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBBn8RmuXVvkbbBB0IquYr9S6hXhIgrQCQ",
      authDomain: "lla5785v3-0.firebaseapp.com",
      projectId: "lla5785v3-0",
      storageBucket: "lla5785v3-0.appspot.com",
      messagingSenderId: "730972554331",
      appId: "1:730972554331:web:d97a5fbacebd6aa6e32b7e",
      measurementId: "G-WZNQ24S4DM"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function fetchAds() {
      try {
        const snapshot = await getDocs(collection(db, "ad_list"));
        const ads = snapshot.docs.map(doc => doc.data());

        const bannerAds = ads.filter(ad => ad.type === "banner");
        const textAds = ads.filter(ad => ad.type === "text");
        const iframeAds = ads.filter(ad => ad.type === "iframe");

        const getRandomAd = arr => arr.length ? arr[Math.floor(Math.random() * arr.length)] : null;

        const bannerAd = getRandomAd(bannerAds);
        const textAd = getRandomAd(textAds);
        const iframeAd = getRandomAd(iframeAds);

        const bannerHTML = bannerAd
          ? `<a href="${bannerAd.targetUrl}" target="_blank">
              <img src="${bannerAd.imageUrl}" alt="Banner Ad" style="width:468px;height:60px;">
            </a>`
          : `<img src="https://via.placeholder.com/468x60?text=Default+Banner+Ad" style="width:468px;height:60px;">`;

        const textHTML = textAd
          ? `<div class="text-ad">
              <a href="${textAd.targetUrl}" target="_blank">${textAd.textContent}</a>
            </div>`
          : `<div class="text-ad">Default Text Ad</div>`;

        const iframeHTML = iframeAd
          ? `<iframe src="${iframeAd.targetUrl}" width="468" height="120" frameborder="0"></iframe>`
          : `<iframe src="https://example.com/default-iframe" width="468" height="120" frameborder="0"></iframe>`;

        document.getElementById("banner-ad").innerHTML = bannerHTML;
        document.getElementById("text-ad").innerHTML = textHTML;
        document.getElementById("iframe-ad").innerHTML = iframeHTML;

      } catch (e) {
        console.error("Error fetching ads:", e);
        document.getElementById("ads-container").innerHTML = "<p>Error loading ads. Try again later.</p>";
      }
    }

    fetchAds();
  </script>

  <!-- Load nav bar -->
  <script>
    fetch("nav_external.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("nav-placeholder").innerHTML = html;
      })
      .catch(() => {
        document.getElementById("nav-placeholder").innerText = "Navigation failed to load.";
      });
  </script>

</body>
</html>
