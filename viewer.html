<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ad Viewer - LLA5785</title>
  <style>
    body {
      background-color: wheat;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .header-container, .footer-container, .nav-container {
      width: 100%;
    }
    .scroll-bar {
      background-color: red;
      color: yellow;
      font-weight: bold;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
    }
    .scroll-bar marquee {
      padding: 4px 0;
    }
    .invite-bar {
      background-color: yellow;
      color: red;
      font-weight: bold;
      font-size: 14px;
      text-align: center;
      padding: 4px;
    }
    .invite-bar a {
      color: red;
      text-decoration: none;
    }
    .ads-container {
      display: flex;
      justify-content: space-around;
      align-items: center;
      max-height: 70px;
      padding: 5px;
      background-color: wheat;
    }
    .ads-container div {
      width: 48%;
      text-align: center;
    }
    .ads-container img {
      max-width: 100%;
      max-height: 60px;
    }
    .ads-container a {
      color: blue;
      text-decoration: underline;
    }
    iframe {
      width: 100%;
      height: 1000px;
      border: none;
    }
    .next-button {
      background-color: blue;
      color: white;
      font-weight: bold;
      padding: 6px 12px;
      margin: 10px auto;
      text-align: center;
      display: block;
      width: 120px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
  <!-- CSP for iframe and inline ads -->
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>
<body>

  <!-- Header -->
  <div class="header-container" id="header-container"></div>

  <!-- Scroll Bar -->
  <div class="scroll-bar">
    <marquee>SCROLL TO VIEW ALL ADS ON THIS PAGE</marquee>
  </div>

  <!-- Invite Link -->
  <div class="invite-bar">
    <a href="https://saphahcentral.github.io/lla5785v3-0/account1.html" target="_blank" rel="noopener noreferrer">
      ðŸ‘‰ ADD YOUR WEBSITE HERE FOR MAXIMUM LIFETIME EXPOSURE!
    </a>
  </div>

  <!-- Ads -->
  <div class="ads-container">
    <div id="banner-ad"></div>
    <div id="text-ad"></div>
  </div>

  <!-- Next Button -->
  <div class="next-button" onclick="fetchAdsAndDisplay()">Next Ad</div>

  <!-- Iframe -->
  <iframe id="ad-iframe" src=""></iframe>

  <!-- Bottom Nav and Footer -->
  <div class="nav-container" id="nav-container"></div>
  <div class="footer-container" id="footer-container"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBBn8RmuXVvkbbBB0IquYr9S6hXhIgrQCQ",
      authDomain: "lla5785.firebaseapp.com",
      projectId: "lla5785",
    };

    // Init
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Fallback ads
    const fallbackAds = [
      {
        image: "https://cdn-images.imagevenue.com/bd/29/ed/ME1AW7GK_o.png",
        url: "https://saphahcentral.github.io/soar2024/index.html",
        text: "SOAR supports the terminally ill - check their e-book!"
      },
      {
        image: "https://cdn-images.imagevenue.com/5a/c1/97/ME1AXEOC_o.png",
        url: "https://lla5785emails.blogspot.com/p/subscribe.html",
        text: "10 emails - a lifetime of information about online marketing"
      },
      {
        image: "https://cdn-thumbs.imagevenue.com/39/f4/40/ME1AXERE_b.jpg",
        url: "https://estcourthospice.blogspot.com/p/home.html",
        text: "Terminal illness support - donations welcome"
      }
    ];

    async function fetchAdsAndDisplay() {
      try {
        const snapshot = await db.collection("ad_list").get();
        let ads = [];
        snapshot.forEach(doc => {
          ads.push(doc.data());
        });

        if (ads.length < 3) throw new Error("Not enough ads");
        
        // Select 3 distinct ads randomly
        const selected = [];
        while (selected.length < 3) {
          const randAd = ads[Math.floor(Math.random() * ads.length)];
          if (!selected.includes(randAd)) selected.push(randAd);
        }

        displayAds(selected[0], selected[1], selected[2]);
      } catch (err) {
        console.warn("Firestore fetch error:", err);
        useFallback();
      }
    }

    function displayAds(bannerAd, textAd, iframeAd) {
      document.getElementById("banner-ad").innerHTML = `
        <a href="${bannerAd.url}" target="_blank" rel="noopener noreferrer">
          <img src="${bannerAd.image}" alt="Banner Ad">
        </a>
      `;
      document.getElementById("text-ad").innerHTML = `
        <a href="${textAd.url}" target="_blank" rel="noopener noreferrer">${textAd.text}</a>
      `;
      document.getElementById("ad-iframe").src = iframeAd.url;  // <-- Use actual ad URL here
    }

    function useFallback() {
      const [bannerAd, textAd, iframeAd] = fallbackAds;
      displayAds(bannerAd, textAd, iframeAd);
    }

    // Load header, nav, footer
    fetch("header.html").then(res => res.text()).then(data => {
      document.getElementById("header-container").innerHTML = data;
    });
    fetch("nav_external.html").then(res => res.text()).then(data => {
      document.getElementById("nav-container").innerHTML = data;
    });
    fetch("footer.html").then(res => res.text()).then(data => {
      document.getElementById("footer-container").innerHTML = data;
    });

    // Initial ads
    fetchAdsAndDisplay();
  </script>

</body>
</html>
